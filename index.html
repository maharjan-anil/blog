<!DOCTYPE html>
<html lang="en" id="htmlRoot">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anil Maharjan Blog</title>
<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="manifest" href="site.webmanifest">
<!-- Critical Theme FOUC Fix -->
<script>
(function() {
const theme = localStorage.getItem('theme') || 'dark';
document.documentElement.setAttribute('data-theme', theme);
if (theme === 'dark') {
document.documentElement.dataset.initialTheme = 'dark';
}
})();
</script>
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Font Awesome Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Quill Rich Text Editor CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<!-- Google Fonts - Minimalist typography -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  /* Minimalist Dark Palette */
  --bg-primary: #0a0a0a;
  --bg-secondary: #111111;
  --bg-tertiary: #1a1a1a;
  --bg-elevated: #1e1e1e;
  
  --text-primary: #f5f5f5;
  --text-secondary: #a0a0a0;
  --text-muted: #666666;
  
  --border-color: #2a2a2a;
  --border-subtle: #1f1f1f;
  
  --accent: #888888;
  --accent-hover: #aaaaaa;
  
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.5);
  
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 14px;
  
  --transition: all 0.2s ease-in-out;
}

[data-theme="light"] {
  --bg-primary: #fafafa;
  --bg-secondary: #ffffff;
  --bg-tertiary: #f0f0f0;
  --bg-elevated: #ffffff;
  
  --text-primary: #1a1a1a;
  --text-secondary: #555555;
  --text-muted: #888888;
  
  --border-color: #e0e0e0;
  --border-subtle: #f0f0f0;
  
  --accent: #666666;
  --accent-hover: #444444;
  
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  color: var(--text-primary);
  line-height: 1.7;
  background-color: var(--bg-primary);
  overflow-x: hidden;
  transition: var(--transition);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

h1, h2, h3, h4, h5, h6 {
  font-family: 'Inter', sans-serif;
  font-weight: 600;
  color: var(--text-primary);
  line-height: 1.3;
  letter-spacing: -0.02em;
}

/* Navigation - Minimalist */
.navbar-custom {
  background-color: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  padding: 14px 0;
  position: sticky;
  top: 0;
  z-index: 1000;
  transition: var(--transition);
}

.nav-brand {
  font-family: 'Inter', sans-serif;
  font-weight: 600;
  font-size: 1.3rem;
  color: var(--text-primary) !important;
  text-decoration: none;
  cursor: pointer;
  transition: var(--transition);
  letter-spacing: -0.01em;
}

.nav-brand:hover {
  opacity: 0.85;
}

.nav-brand span {
  color: var(--text-secondary);
  font-weight: 400;
}

/* Admin Info - Subtle */
.admin-info {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-left: 12px;
}

.admin-avatar {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  background-color: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-primary);
  font-weight: 500;
  font-size: 0.85rem;
}

.admin-name {
  font-weight: 500;
  color: var(--text-primary);
  font-size: 0.9rem;
}

.admin-btn, .logout-btn {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  padding: 7px 18px;
  border-radius: var(--radius-sm);
  font-weight: 500;
  font-size: 0.9rem;
  transition: var(--transition);
  cursor: pointer;
}

.admin-btn:hover, .logout-btn:hover {
  background-color: var(--bg-elevated);
  border-color: var(--accent);
}

.logout-btn {
  background-color: transparent;
  border-color: var(--border-color);
}

.logout-btn:hover {
  border-color: var(--text-muted);
}

/* Theme Toggle - Minimal */
.theme-toggle {
  background: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  color: var(--text-secondary);
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
  margin-left: 8px;
  cursor: pointer;
}

.theme-toggle:hover {
  background-color: var(--bg-elevated);
  color: var(--text-primary);
  border-color: var(--accent);
}

/* Search Input - Clean */
.navbar-search-input {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  padding: 7px 14px;
  width: 200px;
  transition: var(--transition);
  font-size: 0.9rem;
  font-family: 'Inter', sans-serif;
}

.navbar-search-input::placeholder {
  color: var(--text-muted);
}

.navbar-search-input:focus {
  outline: none;
  border-color: var(--accent);
  background-color: var(--bg-elevated);
}

/* Hero Section - Minimal Dark */
.hero-section {
  background-color: var(--bg-secondary);
  border-bottom: 1px solid var(--border-color);
  padding: 90px 0 60px;
  text-align: center;
}

.hero-content {
  max-width: 700px;
  margin: 0 auto;
}

.page-title {
  font-size: 2.8rem;
  font-weight: 700;
  margin-bottom: 16px;
  color: var(--text-primary);
  letter-spacing: -0.03em;
}

.page-subtitle {
  font-size: 1.15rem;
  font-weight: 400;
  color: var(--text-secondary);
  max-width: 550px;
  margin: 0 auto;
  line-height: 1.6;
}

/* Blog Section */
.blog-section {
  padding: 70px 0;
}

.section-title {
  text-align: center;
  margin-bottom: 45px;
  color: var(--text-primary);
  font-size: 1.8rem;
  font-weight: 600;
  position: relative;
  padding-bottom: 12px;
}

.section-title::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 40px;
  height: 2px;
  background-color: var(--accent);
}

/* Blog Container with Sidebar */
.blog-container {
  display: grid;
  grid-template-columns: 1fr 280px;
  gap: 35px;
}

/* Archive Sidebar - Minimal Card */
.archive-sidebar {
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 20px;
  height: fit-content;
  position: sticky;
  top: 90px;
}

.archive-title {
  font-size: 1.1rem;
  color: var(--text-primary);
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--border-color);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.archive-title i {
  color: var(--text-muted);
  font-size: 0.95rem;
}

.archive-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.archive-item {
  margin-bottom: 6px;
}

.archive-link {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 9px 12px;
  background-color: transparent;
  border-radius: var(--radius-sm);
  color: var(--text-secondary);
  text-decoration: none;
  transition: var(--transition);
  cursor: pointer;
  font-size: 0.92rem;
  font-weight: 500;
}

.archive-link:hover {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
}

.archive-link.active {
  background-color: var(--bg-elevated);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}

.archive-count {
  background-color: var(--bg-tertiary);
  color: var(--text-muted);
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 500;
  border: 1px solid var(--border-subtle);
}

.archive-link:hover .archive-count,
.archive-link.active .archive-count {
  background-color: var(--bg-primary);
  color: var(--text-secondary);
}

/* Blog Cards - Clean & Minimal */
.blog-card {
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 24px;
  transition: var(--transition);
  margin-bottom: 24px;
  position: relative;
}

.blog-card:hover {
  border-color: var(--accent);
  transform: translateY(-2px);
}

/* Post Title Clickable - Simple */
.blog-title {
  font-size: 1.4rem;
  color: var(--text-primary);
  font-weight: 600;
  margin-bottom: 12px;
  line-height: 1.4;
  cursor: pointer;
  transition: var(--transition);
}

.blog-title:hover {
  color: var(--accent-hover);
}

/* Post Actions - Subtle */
.post-actions {
  position: absolute;
  top: 16px;
  right: 16px;
  display: flex;
  gap: 8px;
  opacity: 0;
  transition: var(--transition);
}

.blog-card:hover .post-actions {
  opacity: 1;
}

.action-btn {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--border-color);
  background-color: var(--bg-tertiary);
  cursor: pointer;
  font-size: 0.8rem;
  transition: var(--transition);
  color: var(--text-secondary);
}

.action-btn:hover {
  background-color: var(--bg-elevated);
  color: var(--text-primary);
  border-color: var(--accent);
}

.blog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 14px;
  border-bottom: 1px solid var(--border-color);
  flex-wrap: wrap;
  gap: 10px;
}

.blog-meta {
  display: flex;
  gap: 16px;
  font-size: 0.85rem;
  color: var(--text-muted);
  flex-wrap: wrap;
}

.blog-meta i {
  margin-right: 5px;
  color: var(--text-muted);
}

.admin-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background-color: var(--bg-tertiary);
  color: var(--text-secondary);
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 500;
  border: 1px solid var(--border-subtle);
}

/* Content Preview - Clean */
.blog-content {
  color: var(--text-secondary);
  margin-bottom: 16px;
  line-height: 1.7;
  font-size: 0.95rem;
}

.blog-content-preview {
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  max-height: 95px;
}

/* Read More Button - Minimal */
.read-more-btn {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 6px 16px;
  border-radius: var(--radius-sm);
  text-decoration: none;
  font-weight: 500;
  transition: var(--transition);
  cursor: pointer;
  border: 1px solid var(--border-color);
  font-size: 0.85rem;
  margin-top: 8px;
}

.read-more-btn:hover {
  background-color: var(--bg-elevated);
  border-color: var(--accent);
  color: var(--text-primary);
}

.read-more-btn i {
  font-size: 0.7rem;
  transition: var(--transition);
}

.read-more-btn:hover i {
  transform: translateX(2px);
}

/* Featured Image - Clean */
.featured-image {
  width: 100%;
  height: 280px;
  object-fit: cover;
  border-radius: var(--radius-md);
  margin-bottom: 18px;
  border: 1px solid var(--border-color);
}

.blog-image {
  width: 100%;
  height: auto;
  border-radius: var(--radius-sm);
  margin: 16px 0;
  border: 1px solid var(--border-color);
  max-height: 400px;
  object-fit: cover;
}

.blog-video {
  width: 100%;
  height: 320px;
  border-radius: var(--radius-sm);
  margin: 16px 0;
  border: 1px solid var(--border-color);
}

/* Single Post View */
.single-post-view {
  display: none;
}

.single-post-view.active {
  display: block;
}

.blog-list-view {
  display: block;
}

.blog-list-view.hidden {
  display: none;
}

.single-post-header {
  margin-bottom: 28px;
  text-align: center;
}

.single-post-title {
  font-size: 2rem;
  color: var(--text-primary);
  font-weight: 700;
  margin-bottom: 16px;
  line-height: 1.35;
}

.single-post-meta {
  display: flex;
  gap: 18px;
  font-size: 0.9rem;
  color: var(--text-muted);
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-color);
  justify-content: center;
  flex-wrap: wrap;
}

.single-post-meta i {
  margin-right: 6px;
}

.single-post-content {
  font-size: 1.05rem;
  line-height: 1.85;
  color: var(--text-secondary);
}

.single-post-content img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-sm);
  margin: 18px 0;
  border: 1px solid var(--border-color);
}

.single-post-content video {
  max-width: 100%;
  border-radius: var(--radius-sm);
  margin: 18px 0;
  border: 1px solid var(--border-color);
}

.single-post-content iframe {
  width: 100%;
  height: 420px;
  border-radius: var(--radius-sm);
  margin: 18px 0;
  border: 1px solid var(--border-color);
}

/* Video in Quill Editor */
.ql-editor iframe {
  width: 100% !important;
  height: 380px !important;
  max-width: 100%;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-color);
}

.ql-container .ql-video {
  width: 100% !important;
  height: 380px !important;
}

.back-to-posts-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 9px 22px;
  border-radius: var(--radius-sm);
  text-decoration: none;
  font-weight: 500;
  transition: var(--transition);
  cursor: pointer;
  border: 1px solid var(--border-color);
  margin-bottom: 24px;
  font-size: 0.9rem;
}

.back-to-posts-btn:hover {
  background-color: var(--bg-elevated);
  border-color: var(--accent);
}

/* Move to All Posts Button */
.move-to-all-posts-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
  padding: 10px 26px;
  border-radius: var(--radius-sm);
  text-decoration: none;
  font-weight: 500;
  transition: var(--transition);
  cursor: pointer;
  border: 1px solid var(--border-color);
  margin-top: 28px;
  font-size: 0.95rem;
}

.move-to-all-posts-btn:hover {
  background-color: var(--bg-elevated);
  border-color: var(--accent);
}

/* Create Post Button - Minimal Floating */
.create-post-btn {
  position: fixed;
  bottom: 28px;
  right: 28px;
  background-color: var(--bg-elevated);
  color: var(--text-primary);
  width: 52px;
  height: 52px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--border-color);
  box-shadow: var(--shadow-md);
  transition: var(--transition);
  z-index: 100;
  cursor: pointer;
}

.create-post-btn:hover {
  background-color: var(--bg-primary);
  border-color: var(--accent);
  transform: translateY(-2px);
}

.create-post-btn i {
  font-size: 1.3rem;
}

/* Modal Form - Clean */
.form-control-custom {
  background-color: var(--bg-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  padding: 10px 14px;
  transition: var(--transition);
  width: 100%;
  font-family: 'Inter', sans-serif;
  font-size: 0.95rem;
}

.form-control-custom::placeholder {
  color: var(--text-muted);
}

.form-control-custom:focus {
  border-color: var(--accent);
  outline: none;
  background-color: var(--bg-elevated);
}

.form-label {
  font-weight: 500;
  color: var(--text-primary);
  margin-bottom: 8px;
  display: block;
  font-size: 0.9rem;
}

textarea.form-control-custom {
  min-height: 140px;
  resize: vertical;
  font-family: 'Inter', sans-serif;
}

.submit-btn {
  background-color: var(--bg-elevated);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  padding: 11px 28px;
  border-radius: var(--radius-sm);
  font-weight: 500;
  font-size: 1rem;
  transition: var(--transition);
  cursor: pointer;
  width: 100%;
}

.submit-btn:hover {
  background-color: var(--bg-primary);
  border-color: var(--accent);
}

.submit-btn:disabled {
  background-color: var(--bg-tertiary);
  color: var(--text-muted);
  cursor: not-allowed;
  border-color: var(--border-subtle);
}

/* Quill Editor - Minimal Dark */
.quill-editor {
  background-color: var(--bg-tertiary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-sm);
  transition: var(--transition);
}

.quill-editor:focus-within {
  border-color: var(--accent);
}

.ql-toolbar {
  border-radius: var(--radius-sm) var(--radius-sm) 0 0 !important;
  background-color: var(--bg-elevated) !important;
  border-color: var(--border-color) !important;
  border-bottom: 1px solid var(--border-color) !important;
}

.ql-container {
  border-radius: 0 0 var(--radius-sm) var(--radius-sm) !important;
  min-height: 300px;
  border-color: var(--border-color) !important;
}

.ql-editor {
  font-family: 'Inter', sans-serif;
  font-size: 1rem;
  color: var(--text-primary);
  background-color: var(--bg-tertiary);
  min-height: 400px;
  line-height: 1.7;
}

.ql-editor::placeholder {
  color: var(--text-muted);
}

/* Image & Video Upload Buttons - Minimal */
.media-upload-btn {
  background-color: var(--bg-tertiary);
  color: var(--text-secondary);
  border: 1px solid var(--border-color);
  padding: 7px 14px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 0.85rem;
  transition: var(--transition);
  margin-top: 10px;
  margin-right: 8px;
  font-weight: 500;
}

.media-upload-btn:hover {
  background-color: var(--bg-elevated);
  color: var(--text-primary);
  border-color: var(--accent);
}

/* Loading Spinner - Minimal */
.spinner {
  width: 36px;
  height: 36px;
  border: 2px solid var(--border-color);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* No Posts Message - Clean */
.no-posts {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-muted);
}

.no-posts i {
  font-size: 3.5rem;
  color: var(--text-muted);
  margin-bottom: 18px;
  opacity: 0.6;
}

.no-posts h3 {
  font-size: 1.3rem;
  margin-bottom: 8px;
  color: var(--text-secondary);
}

.no-posts p {
  font-size: 1rem;
  margin-top: 10px;
}

/* Alert Messages - Minimal */
.alert-custom {
  padding: 14px 18px;
  border-radius: var(--radius-sm);
  margin-bottom: 20px;
  display: none;
  font-weight: 500;
  font-size: 0.9rem;
  border: 1px solid;
}

.alert-success {
  background-color: rgba(34, 197, 94, 0.1);
  color: #22c55e;
  border-color: rgba(34, 197, 94, 0.3);
}

.alert-error {
  background-color: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border-color: rgba(239, 68, 68, 0.3);
}

/* Login Modal - Clean */
.login-modal {
  max-width: 420px;
  background-color: var(--bg-secondary);
  border: 1px solid var(--border-color);
}

.login-header {
  text-align: center;
  padding: 20px 0;
  border-bottom: 1px solid var(--border-color);
  margin-bottom: 24px;
}

.login-header i {
  font-size: 2.5rem;
  color: var(--text-muted);
  margin-bottom: 12px;
}

.login-header h3 {
  color: var(--text-primary);
  margin-bottom: 4px;
  font-weight: 600;
}

.login-header p {
  color: var(--text-muted);
  font-size: 0.9rem;
}

/* Footer - Minimal */
.footer-section {
  background-color: var(--bg-secondary);
  border-top: 1px solid var(--border-color);
  color: var(--text-secondary);
  padding: 35px 0;
  text-align: center;
}

.copyright {
  font-size: 0.9rem;
  color: var(--text-muted);
}

.copyright a {
  color: var(--text-secondary);
  text-decoration: none;
  transition: var(--transition);
}

.copyright a:hover {
  color: var(--text-primary);
}

/* Current Filter Badge - Minimal */
.current-filter {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background-color: var(--bg-tertiary);
  color: var(--text-secondary);
  padding: 7px 18px;
  border-radius: var(--radius-sm);
  font-weight: 500;
  margin-bottom: 20px;
  font-size: 0.9rem;
  border: 1px solid var(--border-color);
}

.clear-filter {
  margin-left: 10px;
  cursor: pointer;
  opacity: 0.7;
  transition: var(--transition);
}

.clear-filter:hover {
  opacity: 1;
}

/* Share Buttons - Minimal */
.share-buttons {
  display: flex;
  gap: 10px;
  margin-top: 28px;
  padding-top: 20px;
  border-top: 1px solid var(--border-color);
  justify-content: center;
  flex-wrap: wrap;
}

.share-btn {
  width: 38px;
  height: 38px;
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--border-color);
  background-color: var(--bg-tertiary);
  cursor: pointer;
  transition: var(--transition);
  color: var(--text-secondary);
  font-size: 0.9rem;
}

.share-btn:hover {
  background-color: var(--bg-elevated);
  color: var(--text-primary);
  border-color: var(--accent);
}

/* Tags - Minimal */
.blog-tags {
  margin-top: 14px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.blog-tags .badge {
  background-color: var(--bg-tertiary);
  color: var(--text-muted);
  padding: 4px 12px;
  border-radius: 20px;
  font-weight: 500;
  font-size: 0.8rem;
  border: 1px solid var(--border-subtle);
  transition: var(--transition);
}

.blog-tags .badge:hover {
  background-color: var(--bg-elevated);
  color: var(--text-secondary);
  border-color: var(--accent);
}

/* Responsive */
@media (max-width: 992px) {
  .blog-container {
    grid-template-columns: 1fr;
  }
  .archive-sidebar {
    position: static;
    margin-bottom: 28px;
  }
  .page-title { font-size: 2.3rem; }
  .section-title { font-size: 1.6rem; }
  .blog-title { font-size: 1.3rem; }
  .single-post-title { font-size: 1.8rem; }
  .post-actions {
    position: static;
    margin-top: 12px;
    opacity: 1;
    justify-content: flex-end;
  }
  .admin-info {
    flex-direction: row;
    align-items: center;
    gap: 8px;
  }
  .navbar-search-input {
    width: 100%;
    margin-bottom: 10px;
  }
  .ql-editor iframe {
    height: 340px !important;
  }
  .single-post-content iframe {
    height: 380px;
  }
  .featured-image {
    height: 240px;
  }
}

@media (max-width: 768px) {
  .hero-section { padding: 70px 0 45px; }
  .page-title { font-size: 1.9rem; }
  .page-subtitle { font-size: 1.05rem; }
  .blog-section { padding: 55px 0; }
  .section-title { font-size: 1.5rem; margin-bottom: 38px; }
  .blog-card { padding: 20px; }
  .create-post-btn {
    bottom: 22px;
    right: 22px;
    width: 48px;
    height: 48px;
  }
  .blog-video {
    height: 260px;
  }
  .ql-container {
    min-height: 260px;
  }
  .single-post-title { font-size: 1.7rem; }
  .single-post-meta {
    flex-direction: column;
    gap: 10px;
    align-items: center;
  }
  .blog-content-preview {
    -webkit-line-clamp: 3;
    max-height: 75px;
  }
  .read-more-btn {
    padding: 5px 14px;
    font-size: 0.82rem;
  }
  .move-to-all-posts-btn {
    width: 100%;
    justify-content: center;
  }
  .featured-image {
    height: 200px;
  }
  .media-upload-btn {
    display: block;
    width: 100%;
    margin-bottom: 8px;
  }
  .ql-editor iframe {
    height: 300px !important;
  }
  .single-post-content iframe {
    height: 300px;
  }
  .archive-sidebar {
    padding: 18px;
  }
}

@media (max-width: 576px) {
  .page-title { font-size: 1.6rem; }
  .nav-brand { font-size: 1.2rem; }
  .blog-title { font-size: 1.25rem; }
  .blog-meta {
    flex-direction: column;
    gap: 8px;
  }
  .blog-video {
    height: 220px;
  }
  .action-btn {
    width: 30px;
    height: 30px;
    font-size: 0.75rem;
  }
  .ql-toolbar.ql-snow .ql-formats {
    margin-right: 6px;
  }
  .featured-image {
    height: 180px;
  }
  .ql-editor iframe {
    height: 260px !important;
  }
  .single-post-content iframe {
    height: 260px;
  }
  .hero-section {
    padding: 60px 0 40px;
  }
  .section-title {
    font-size: 1.4rem;
  }
  .blog-card {
    padding: 18px;
  }
  .single-post-title {
    font-size: 1.5rem;
  }
}
</style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-custom">
<div class="container">
<a class="navbar-brand nav-brand" href="index.html" onclick="window.location.href='index.html'; return false;" aria-label="Home">
  Anil <span>Maharjan</span>
</a>
<button
class="navbar-toggler"
type="button"
data-bs-toggle="collapse"
data-bs-target="#navbarNav"
aria-controls="navbarNav"
aria-expanded="false"
aria-label="Toggle navigation"
>
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav ms-auto align-items-center">
<!-- Search Input -->
<li class="nav-item me-3">
<input type="text" id="searchInput" class="navbar-search-input" placeholder="Search...">
</li>
<li class="nav-item" id="authNav">
<!-- Auth buttons will be inserted here dynamically -->
</li>
<li class="nav-item">
<button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
<i class="fas fa-moon"></i>
</button>
</li>
</ul>
</div>
</div>
</nav>

<!-- Hero Section -->
<section class="hero-section">
<div class="container">
<div class="row">
<div class="col-lg-10 mx-auto hero-content">
<h1 class="page-title">My Blog</h1>
<p class="page-subtitle">Thoughts on productivity, web development, and personal growth</p>
</div>
</div>
</div>
</section>

<!-- Blog Section -->
<section class="blog-section">
<div class="container">
<h2 class="section-title">Latest Posts</h2>
<div id="blogAlertContainer"></div>
<!-- Current Filter Badge -->
<div id="currentFilterBadge" style="display: none;"></div>
<div class="blog-container">
<!-- Blog Posts -->
<div id="blogPostsContainer">
<!-- Blog List View -->
<div id="blogListView" class="blog-list-view">
<div class="text-center">
<div class="spinner"></div>
<p>Loading posts...</p>
</div>
</div>
<!-- Single Post View -->
<div id="singlePostView" class="single-post-view">
<button class="back-to-posts-btn" id="backToPostsBtn">
<i class="fas fa-arrow-left"></i> Back
</button>
<div id="singlePostContent"></div>
</div>
</div>
<!-- Archive Sidebar -->
<aside class="archive-sidebar">
<h3 class="archive-title"><i class="fas fa-archive"></i> Archives</h3>
<div id="archiveListContainer">
<div class="text-center">
<div class="spinner" style="width: 28px; height: 28px;"></div>
</div>
</div>
</aside>
</div>
</div>
</section>

<!-- Create Post Button -->
<button class="create-post-btn" id="createPostBtn" aria-label="Create new post" style="display: none;">
<i class="fas fa-plus"></i>
</button>

<!-- Admin Login Modal -->
<div class="modal fade" id="adminLoginModal" tabindex="-1" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered login-modal">
<div class="modal-content">
<div class="modal-header border-0 pb-0">
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
</div>
<div class="modal-body">
<div class="login-header">
<i class="fas fa-user-shield"></i>
<h3>Admin Login</h3>
<p>Sign in to manage posts</p>
</div>
<div id="loginAlertContainer"></div>
<form id="adminLoginForm">
<div class="mb-3">
<label for="adminEmail" class="form-label">Email</label>
<input type="email" class="form-control-custom" id="adminEmail" required placeholder="admin@example.com">
</div>
<div class="mb-3">
<label for="adminPassword" class="form-label">Password</label>
<input type="password" class="form-control-custom" id="adminPassword" required placeholder="••••••••">
</div>
<div class="mb-3 form-check">
<input type="checkbox" class="form-check-input" id="rememberAdmin" style="background-color: var(--bg-tertiary); border-color: var(--border-color);">
<label class="form-check-label" for="rememberAdmin" style="color: var(--text-secondary);">Remember me</label>
</div>
<button type="submit" class="submit-btn" id="submitAdminLoginBtn">
Sign In
</button>
</form>
</div>
</div>
</div>
</div>

<!-- Create/Edit Post Modal -->
<div class="modal fade" id="postModal" tabindex="-1" aria-hidden="true">
<div class="modal-dialog modal-lg">
<div class="modal-content" style="background-color: var(--bg-secondary); border: 1px solid var(--border-color);">
<div class="modal-header" style="border-bottom-color: var(--border-color);">
<h5 class="modal-title" id="postModalLabel" style="color: var(--text-primary);">Create New Post</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
</div>
<div class="modal-body">
<div id="formAlertContainer"></div>
<form id="postForm">
<input type="hidden" id="postId">
<div class="mb-3">
<label for="postTitle" class="form-label">Title *</label>
<input type="text" class="form-control-custom" id="postTitle" required placeholder="Post title">
</div>
<div class="mb-3">
<label for="featuredImage" class="form-label">Featured Image URL</label>
<input type="url" class="form-control-custom" id="featuredImage" placeholder="https://...">
</div>
<div class="mb-3">
<label for="postContent" class="form-label">Content *</label>
<div id="quillEditor"></div>
<input type="hidden" id="postContent" name="postContent" required>
<div class="mt-2">
<button type="button" class="media-upload-btn" id="insertImageUrlBtn">
<i class="fas fa-link me-1"></i> Image URL
</button>
<button type="button" class="media-upload-btn" id="uploadImageBtn">
<i class="fas fa-upload me-1"></i> Upload
</button>
<button type="button" class="media-upload-btn" id="insertVideoUrlBtn">
<i class="fas fa-video me-1"></i> Video URL
</button>
</div>
<input type="file" id="imageFileInput" accept="image/*" style="display: none;">
</div>
<div class="mb-3">
<label for="postImage" class="form-label">Additional Image URL</label>
<input type="url" class="form-control-custom" id="postImage" placeholder="https://...">
</div>
<div class="mb-3">
<label for="postVideo" class="form-label">YouTube Video ID</label>
<input type="text" class="form-control-custom" id="postVideo" placeholder="dQw4w9WgXcQ">
</div>
<div class="mb-3">
<label for="postTags" class="form-label">Tags</label>
<input type="text" class="form-control-custom" id="postTags" placeholder="tag1, tag2">
</div>
<button type="submit" class="submit-btn" id="submitPostBtn">
Publish Post
</button>
</form>
</div>
</div>
</div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content" style="background-color: var(--bg-secondary); border: 1px solid var(--border-color);">
<div class="modal-header" style="border-bottom-color: var(--border-color);">
<h5 class="modal-title" id="deleteConfirmModalLabel" style="color: var(--text-primary);">Confirm Delete</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
</div>
<div class="modal-body text-center">
<i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 16px;"></i>
<p class="lead" style="color: var(--text-primary);">Delete this post?</p>
<p class="text-muted">This cannot be undone.</p>
</div>
<div class="modal-footer justify-content-center" style="border-top-color: var(--border-color);">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="background-color: var(--bg-tertiary); border-color: var(--border-color); color: var(--text-primary);">Cancel</button>
<button type="button" class="btn btn-danger" id="confirmDeleteBtn" style="background-color: rgba(239, 68, 68, 0.15); border-color: rgba(239, 68, 68, 0.3); color: #ef4444;">Delete</button>
</div>
</div>
</div>
</div>

<!-- Footer -->
<footer class="footer-section">
<div class="container">
<div class="row">
<div class="col-12">
<div class="copyright">
<p>&copy; <span id="currentYear"></span> Anil Maharjan</p>
</div>
</div>
</div>
</div>
</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<!-- Quill Rich Text Editor -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
// === FIREBASE CONFIGURATION ===
const firebaseConfig = {
apiKey: "AIzaSyATt6Bc5-Jes8zXz6aLp9b9wi9OPFhVE0s",
authDomain: "anil-blog-af680.firebaseapp.com",
projectId: "anil-blog-af680",
storageBucket: "anil-blog-af680.firebasestorage.app",
messagingSenderId: "702295756466",
appId: "1:702295756466:web:df537c87f0ef46d0d943ab"
};

// DOM Elements
const html = document.getElementById('htmlRoot');
const toggleBtn = document.getElementById('themeToggle');
const icon = toggleBtn.querySelector('i');
const createPostBtn = document.getElementById('createPostBtn');
const postForm = document.getElementById('postForm');
const postModalLabel = document.getElementById('postModalLabel');
const submitPostBtn = document.getElementById('submitPostBtn');
const postIdInput = document.getElementById('postId');
const blogPostsContainer = document.getElementById('blogPostsContainer');
const blogListView = document.getElementById('blogListView');
const singlePostView = document.getElementById('singlePostView');
const singlePostContent = document.getElementById('singlePostContent');
const backToPostsBtn = document.getElementById('backToPostsBtn');
const blogAlertContainer = document.getElementById('blogAlertContainer');
const formAlertContainer = document.getElementById('formAlertContainer');
const loginAlertContainer = document.getElementById('loginAlertContainer');
const deleteConfirmModal = document.getElementById('deleteConfirmModal');
const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
const authNav = document.getElementById('authNav');
const adminLoginForm = document.getElementById('adminLoginForm');
const submitAdminLoginBtn = document.getElementById('submitAdminLoginBtn');
const searchInput = document.getElementById('searchInput');
const archiveListContainer = document.getElementById('archiveListContainer');
const currentFilterBadge = document.getElementById('currentFilterBadge');
const insertImageUrlBtn = document.getElementById('insertImageUrlBtn');
const uploadImageBtn = document.getElementById('uploadImageBtn');
const insertVideoUrlBtn = document.getElementById('insertVideoUrlBtn');
const imageFileInput = document.getElementById('imageFileInput');

let currentPostId = null;
let currentUser = null;
let quill = null;
let allPosts = [];
let currentArchiveFilter = null;
let currentPostData = null;
let storage = null;

// Set current year
document.getElementById('currentYear').textContent = new Date().getFullYear();

// === THEME SYSTEM ===
function applyTheme(theme) {
html.setAttribute('data-theme', theme);
icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
localStorage.setItem('theme', theme);
if (quill) {
const editor = document.querySelector('.ql-editor');
if (editor) {
editor.style.backgroundColor = theme === 'dark' ? '#1a1a1a' : '#ffffff';
editor.style.color = theme === 'dark' ? '#f5f5f5' : '#1a1a1a';
}
}
window.dispatchEvent(new CustomEvent('themeChanged', { detail: theme }));
}

toggleBtn.addEventListener('click', () => {
const current = html.getAttribute('data-theme');
const newTheme = current === 'dark' ? 'light' : 'dark';
applyTheme(newTheme);
});

window.addEventListener('storage', function(e) {
if (e.key === 'theme') {
applyTheme(e.newValue);
}
});

// === FIREBASE INITIALIZATION ===
let db = null;
let auth = null;
let firebaseInitialized = false;

function showBlogAlert(message, type = 'error') {
const alertDiv = document.createElement('div');
alertDiv.className = `alert-custom alert-${type === 'error' ? 'error' : 'success'}`;
alertDiv.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'} me-2"></i>${message}`;
blogAlertContainer.innerHTML = '';
blogAlertContainer.appendChild(alertDiv);
alertDiv.style.display = 'block';
setTimeout(() => {
alertDiv.style.display = 'none';
}, 4000);
}

function showFormAlert(message, type = 'error', container = formAlertContainer) {
const alertDiv = document.createElement('div');
alertDiv.className = `alert-custom alert-${type === 'error' ? 'error' : 'success'}`;
alertDiv.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-triangle' : 'check-circle'} me-2"></i>${message}`;
container.innerHTML = '';
container.appendChild(alertDiv);
alertDiv.style.display = 'block';
setTimeout(() => {
alertDiv.style.display = 'none';
}, 4000);
}

function initializeFirebase() {
try {
if (!firebase.apps.length) {
firebase.initializeApp(firebaseConfig);
}
db = firebase.firestore();
auth = firebase.auth();
storage = firebase.storage();
auth.onAuthStateChanged(user => {
currentUser = user;
updateAuthUI();
loadBlogPosts();
});
firebaseInitialized = true;
} catch (error) {
console.error('Firebase error:', error);
showBlogAlert('Config error: ' + error.message, 'error');
firebaseInitialized = false;
}
}

function updateAuthUI() {
if (currentUser) {
const displayName = currentUser.displayName || currentUser.email.split('@')[0];
const initials = displayName.charAt(0).toUpperCase();
authNav.innerHTML = `
<div class="admin-info">
<div class="admin-avatar">${initials}</div>
<span class="admin-name">${displayName}</span>
<button class="logout-btn" id="logoutBtn">Logout</button>
</div>
`;
createPostBtn.style.display = 'flex';
document.getElementById('logoutBtn').addEventListener('click', signOutAdmin);
} else {
authNav.innerHTML = `<button class="admin-btn" id="adminLoginBtn">Login</button>`;
createPostBtn.style.display = 'none';
document.getElementById('adminLoginBtn').addEventListener('click', () => {
new bootstrap.Modal(document.getElementById('adminLoginModal')).show();
});
}
}

async function signInAdmin(email, password) {
try {
await auth.signInWithEmailAndPassword(email, password);
bootstrap.Modal.getInstance(document.getElementById('adminLoginModal')).hide();
return true;
} catch (error) {
throw error;
}
}

async function signOutAdmin() {
try {
await auth.signOut();
showBlogAlert('Signed out', 'success');
} catch (error) {
showBlogAlert('Sign out failed', 'error');
}
}

// === RICH TEXT EDITOR ===
function initializeQuillEditor() {
quill = new Quill('#quillEditor', {
modules: {
toolbar: [
[{ 'header': [1, 2, 3, false] }],
['bold', 'italic', 'underline'],
[{ 'color': [] }, { 'background': [] }],
[{ 'list': 'ordered'}, { 'list': 'bullet' }],
[{ 'align': [] }],
['link', 'image', 'video'],
['clean']
]
},
theme: 'snow',
placeholder: 'Write something...'
});
const saved = localStorage.getItem('quillContent');
if (saved) quill.root.innerHTML = saved;
quill.on('text-change', () => {
document.getElementById('postContent').value = quill.root.innerHTML;
localStorage.setItem('quillContent', quill.root.innerHTML);
});
applyTheme(html.getAttribute('data-theme'));
}

function clearQuillEditor() {
if (quill) {
quill.root.innerHTML = '<p><br></p>';
localStorage.removeItem('quillContent');
document.getElementById('postContent').value = '';
}
}

// === MEDIA UPLOAD ===
insertImageUrlBtn.addEventListener('click', () => {
const url = prompt('Image URL:');
if (url) {
const range = quill.getSelection(true);
quill.insertEmbed(range.index, 'image', url);
quill.setSelection(range.index + 1);
}
});

uploadImageBtn.addEventListener('click', () => imageFileInput.click());

imageFileInput.addEventListener('change', async (e) => {
const file = e.target.files[0];
if (!file || !file.type.startsWith('image/') || file.size > 5*1024*1024) {
showFormAlert('Invalid image (max 5MB)', 'error');
return;
}
const original = uploadImageBtn.innerHTML;
uploadImageBtn.disabled = true;
uploadImageBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
try {
const ref = storage.ref(`blog-images/${Date.now()}_${file.name}`);
await ref.put(file);
const url = await ref.getDownloadURL();
const range = quill.getSelection(true);
quill.insertEmbed(range.index, 'image', url);
quill.setSelection(range.index + 1);
showFormAlert('Uploaded!', 'success');
} catch (err) {
showFormAlert('Upload failed: ' + err.message, 'error');
} finally {
uploadImageBtn.disabled = false;
uploadImageBtn.innerHTML = original;
imageFileInput.value = '';
}
});

insertVideoUrlBtn.addEventListener('click', () => {
const url = prompt('Video URL:');
if (url) {
let embed = url;
const yt = url.match(/(?:youtube\.com\/.*v=|youtu\.be\/)([^&?\/]{11})/);
if (yt) embed = `https://www.youtube.com/embed/${yt[1]}`;
const range = quill.getSelection(true);
quill.insertEmbed(range.index, 'video', embed);
quill.setSelection(range.index + 1);
}
});

// === ARCHIVES ===
function getMonthYearKey(date) {
const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
return {
key: `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}`,
display: `${months[date.getMonth()]} ${date.getFullYear()}`
};
}

function groupPostsByArchive(posts) {
const map = {};
posts.forEach(p => {
const d = p.createdAt?.toDate?.() || new Date();
const {key, display} = getMonthYearKey(d);
if (!map[key]) map[key] = {display, count: 0, posts: []};
map[key].count++;
map[key].posts.push(p);
});
return Object.entries(map).sort((a,b)=>b[0].localeCompare(a[0])).map(([k,v])=>({key:k,...v}));
}

function renderArchiveList(data) {
if (!data.length) {
archiveListContainer.innerHTML = '<p class="text-muted text-center">No archives</p>';
return;
}
let html = '<ul class="archive-list">';
data.forEach(a => {
const active = currentArchiveFilter === a.key;
html += `<li><div class="archive-link ${active?'active':''}" data-key="${a.key}"><span>${a.display}</span><span class="archive-count">${a.count}</span></div></li>`;
});
html += '</ul>';
archiveListContainer.innerHTML = html;
document.querySelectorAll('.archive-link').forEach(l => {
l.addEventListener('click', () => filterByArchive(l.dataset.key));
});
}

function filterByArchive(key) {
if (currentArchiveFilter === key) {
currentArchiveFilter = null;
currentFilterBadge.style.display = 'none';
} else {
currentArchiveFilter = key;
const p = allPosts.find(x => {
const d = x.createdAt?.toDate?.() || new Date();
return getMonthYearKey(d).key === key;
});
if (p) {
const {display} = getMonthYearKey(p.createdAt?.toDate?.() || new Date());
currentFilterBadge.innerHTML = `<span class="current-filter">Filter: ${display} <span class="clear-filter" id="clearArch"><i class="fas fa-times"></i></span></span>`;
currentFilterBadge.style.display = 'block';
document.getElementById('clearArch')?.addEventListener('click', () => {
currentArchiveFilter = null;
currentFilterBadge.style.display = 'none';
renderBlogPosts(allPosts);
updateArchiveUI();
});
}
}
const filtered = currentArchiveFilter ? allPosts.filter(p => {
const d = p.createdAt?.toDate?.() || new Date();
return getMonthYearKey(d).key === currentArchiveFilter;
}) : allPosts;
renderBlogPosts(filtered);
updateArchiveUI();
}

function updateArchiveUI() {
document.querySelectorAll('.archive-link').forEach(l => {
l.classList.toggle('active', l.dataset.key === currentArchiveFilter);
});
}

// === BLOG ===
async function loadBlogPosts() {
if (!firebaseInitialized || !db) return;
try {
blogListView.innerHTML = '<div class="text-center"><div class="spinner"></div><p>Loading...</p></div>';
const snap = await db.collection('blogPosts').orderBy('createdAt','desc').get();
if (snap.empty) {
blogListView.innerHTML = '<div class="no-posts"><i class="fas fa-inbox"></i><h3>No posts</h3><p>Be the first!</p></div>';
archiveListContainer.innerHTML = '<p class="text-muted text-center">No archives</p>';
return;
}
allPosts = [];
snap.forEach(doc => allPosts.push({id: doc.id, ...doc.data()}));
renderArchiveList(groupPostsByArchive(allPosts));
renderBlogPosts(allPosts);
} catch (err) {
console.error(err);
blogListView.innerHTML = `<div class="alert-custom alert-error"><i class="fas fa-exclamation-triangle"></i> ${err.message}</div>`;
}
}

function stripHtml(html) {
const d = document.createElement('div');
d.innerHTML = html;
return d.textContent || d.innerText || '';
}

function getPreview(content, limit = 350) {
const text = stripHtml(content);
if (text.length <= limit) return text;
let p = text.slice(0, limit);
const lastDot = p.lastIndexOf('.');
if (lastDot > limit * 0.6) p = p.slice(0, lastDot + 1);
return p.trim() + '...';
}

function renderBlogPosts(posts) {
if (!posts.length) {
blogListView.innerHTML = '<div class="no-posts"><i class="fas fa-search"></i><h3>No results</h3></div>';
return;
}
let html = '';
posts.forEach(p => {
const id = p.id;
const d = p.createdAt?.toDate?.() || new Date();
const date = d.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
const featured = p.featuredImage ? `<img src="${p.featuredImage}" alt="${p.title}" class="featured-image">` : '';
let media = '';
if (p.imageUrl) media = `<img src="${p.imageUrl}" class="blog-image">`;
if (p.videoId) media = `<div class="ratio ratio-16x9 blog-video"><iframe src="https://www.youtube.com/embed/${p.videoId}" frameborder="0" allowfullscreen></iframe></div>`;
const tags = p.tags?.length ? `<div class="blog-tags">${p.tags.map(t=>`<span class="badge">#${t}</span>`).join('')}</div>` : '';
const actions = currentUser ? `<div class="post-actions"><button class="action-btn edit-btn" data-id="${id}"><i class="fas fa-edit"></i></button><button class="action-btn delete-btn" data-id="${id}"><i class="fas fa-trash"></i></button></div>` : '';
html += `
<div class="blog-card" data-id="${id}">
${actions}
<div class="blog-header">
<div class="blog-meta">
<span><i class="fas fa-calendar"></i> ${date}</span>
<span><i class="fas fa-user"></i> ${p.authorName||'Admin'}</span>
${currentUser?'<span class="admin-badge">Admin</span>':''}
</div>
</div>
${featured}
<h3 class="blog-title" data-id="${id}">${p.title}</h3>
<div class="blog-content blog-content-preview">${getPreview(p.content)}</div>
${media ? '<div style="margin-top:12px"><span class="badge">Has media</span></div>' : ''}
${tags}
<button class="read-more-btn" data-id="${id}">Read <i class="fas fa-arrow-right"></i></button>
</div>`;
});
blogListView.innerHTML = html;
document.querySelectorAll('.blog-title, .read-more-btn').forEach(el => {
el.addEventListener('click', e => { e.stopPropagation(); openSinglePost(el.dataset.id); });
});
document.querySelectorAll('.edit-btn').forEach(btn => {
btn.addEventListener('click', e => { e.stopPropagation(); openEditModal(btn.dataset.id); });
});
document.querySelectorAll('.delete-btn').forEach(btn => {
btn.addEventListener('click', e => { e.stopPropagation(); openDeleteConfirm(btn.dataset.id); });
});
}

// === SINGLE POST ===
function openSinglePost(id) {
const p = allPosts.find(x => x.id === id);
if (!p) return showBlogAlert('Not found', 'error');
currentPostData = p;
const d = p.createdAt?.toDate?.() || new Date();
const date = d.toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
const featured = p.featuredImage ? `<img src="${p.featuredImage}" alt="${p.title}" class="featured-image">` : '';
let media = '';
if (p.imageUrl) media = `<img src="${p.imageUrl}" class="blog-image">`;
if (p.videoId) media = `<div class="ratio ratio-16x9 blog-video"><iframe src="https://www.youtube.com/embed/${p.videoId}" frameborder="0" allowfullscreen></iframe></div>`;
const tags = p.tags?.length ? `<div class="blog-tags mt-3">${p.tags.map(t=>`<span class="badge">#${t}</span>`).join('')}</div>` : '';
const adminActions = currentUser ? `<div style="display:flex;gap:10px;margin-top:20px"><button class="submit-btn" onclick="openEditModal('${id}')" style="width:auto">Edit</button><button class="submit-btn" onclick="openDeleteConfirm('${id}')" style="width:auto;background:rgba(239,68,68,0.15);border-color:rgba(239,68,68,0.3);color:#ef4444">Delete</button></div>` : '';
const shares = `<div class="share-buttons"><button class="share-btn" onclick="share('fb')"><i class="fab fa-facebook-f"></i></button><button class="share-btn" onclick="share('tw')"><i class="fab fa-twitter"></i></button><button class="share-btn" onclick="share('li')"><i class="fab fa-linkedin-in"></i></button><button class="share-btn" onclick="share('wa')"><i class="fab fa-whatsapp"></i></button></div>`;
singlePostContent.innerHTML = `
<div class="single-post-header">
<h1 class="single-post-title">${p.title}</h1>
<div class="single-post-meta">
<span><i class="fas fa-calendar"></i> ${date}</span>
<span><i class="fas fa-user"></i> ${p.authorName||'Admin'}</span>
<span><i class="fas fa-clock"></i> ${Math.ceil(stripHtml(p.content).split(/\s+/).length/200)} min</span>
</div>
</div>
${featured}
<div class="single-post-content">${p.content}</div>
${media}
${tags}
${adminActions}
${shares}
<div style="text-align:center;margin-top:30px"><button class="move-to-all-posts-btn" id="backAll"><i class="fas fa-list"></i> All Posts</button></div>
`;
blogListView.classList.add('hidden');
singlePostView.classList.add('active');
window.scrollTo({top:0,behavior:'smooth'});
window.location.hash = `post-${id}`;
document.getElementById('backAll')?.addEventListener('click', closeSinglePost);
}

function closeSinglePost() {
blogListView.classList.remove('hidden');
singlePostView.classList.remove('active');
currentPostData = null;
window.location.hash = '';
}

function share(plat) {
if (!currentPostData) return;
const url = encodeURIComponent(window.location.href);
const t = encodeURIComponent(currentPostData.title);
const links = {fb:`https://facebook.com/sharer/sharer.php?u=${url}`,tw:`https://twitter.com/intent/tweet?url=${url}&text=${t}`,li:`https://linkedin.com/shareArticle?url=${url}&title=${t}`,wa:`https://wa.me/?text=${t}%20${url}`};
if (links[plat]) window.open(links[plat],'_blank','width=600,height=400');
}

backToPostsBtn.addEventListener('click', closeSinglePost);

window.addEventListener('load', () => {
const h = window.location.hash;
if (h?.startsWith('#post-')) setTimeout(() => openSinglePost(h.replace('#post-','')), 800);
});

// === CRUD ===
async function openEditModal(id) {
if (!currentUser) return new bootstrap.Modal(document.getElementById('adminLoginModal')).show();
try {
const doc = await db.collection('blogPosts').doc(id).get();
if (!doc.exists) return showFormAlert('Not found', 'error');
const p = doc.data();
postIdInput.value = id;
document.getElementById('postTitle').value = p.title || '';
document.getElementById('featuredImage').value = p.featuredImage || '';
document.getElementById('postImage').value = p.imageUrl || '';
document.getElementById('postVideo').value = p.videoId || '';
document.getElementById('postTags').value = p.tags?.join(', ') || '';
if (quill) { quill.root.innerHTML = p.content || '<p><br></p>'; document.getElementById('postContent').value = p.content || ''; }
postModalLabel.textContent = 'Edit Post';
submitPostBtn.innerHTML = 'Update';
new bootstrap.Modal(document.getElementById('postModal')).show();
} catch (err) { showFormAlert('Error: ' + err.message, 'error'); }
}

async function savePost(data, id = null) {
if (!db || !currentUser) throw new Error('Not authenticated');
const post = {...data, authorId: currentUser.uid, authorName: currentUser.displayName||currentUser.email.split('@')[0], authorEmail: currentUser.email};
if (id) await db.collection('blogPosts').doc(id).update({...post, updatedAt: firebase.firestore.FieldValue.serverTimestamp()});
else await db.collection('blogPosts').add({...post, createdAt: firebase.firestore.FieldValue.serverTimestamp()});
return true;
}

async function deletePost(id) {
if (!db || !currentUser) throw new Error('Not authenticated');
await db.collection('blogPosts').doc(id).delete();
return true;
}

postForm.addEventListener('submit', async (e) => {
e.preventDefault();
if (!currentUser) return new bootstrap.Modal(document.getElementById('adminLoginModal')).show();
const id = postIdInput.value.trim();
const title = document.getElementById('postTitle').value.trim();
const content = document.getElementById('postContent').value.trim();
if (!title || !content) return showFormAlert('Title & content required', 'error');
const original = submitPostBtn.innerHTML;
submitPostBtn.disabled = true;
submitPostBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
try {
await savePost({
title, content,
featuredImage: document.getElementById('featuredImage').value.trim() || null,
imageUrl: document.getElementById('postImage').value.trim() || null,
videoId: document.getElementById('postVideo').value.trim() || null,
tags: document.getElementById('postTags').value.trim().split(',').map(t=>t.trim()).filter(Boolean)
}, id || null);
postForm.reset();
postIdInput.value = '';
clearQuillEditor();
bootstrap.Modal.getInstance(document.getElementById('postModal'))?.hide();
postModalLabel.textContent = 'Create New Post';
submitPostBtn.innerHTML = 'Publish Post';
showFormAlert(id ? 'Updated' : 'Published', 'success');
setTimeout(() => { currentArchiveFilter = null; currentFilterBadge.style.display = 'none'; closeSinglePost(); loadBlogPosts(); }, 400);
} catch (err) { showFormAlert('Error: ' + err.message, 'error'); }
finally { submitPostBtn.disabled = false; submitPostBtn.innerHTML = original; }
});

function openDeleteConfirm(id) {
if (!currentUser) return new bootstrap.Modal(document.getElementById('adminLoginModal')).show();
currentPostId = id;
new bootstrap.Modal(deleteConfirmModal).show();
}

confirmDeleteBtn.addEventListener('click', async () => {
if (!currentPostId || !currentUser) return;
const original = confirmDeleteBtn.innerHTML;
confirmDeleteBtn.disabled = true;
confirmDeleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
try {
await deletePost(currentPostId);
bootstrap.Modal.getInstance(deleteConfirmModal)?.hide();
showBlogAlert('Deleted', 'success');
currentArchiveFilter = null;
currentFilterBadge.style.display = 'none';
closeSinglePost();
loadBlogPosts();
} catch (err) { showBlogAlert('Error: ' + err.message, 'error'); }
finally { confirmDeleteBtn.disabled = false; confirmDeleteBtn.innerHTML = original; currentPostId = null; }
});

createPostBtn.addEventListener('click', () => {
if (!currentUser) return new bootstrap.Modal(document.getElementById('adminLoginModal')).show();
if (!firebaseInitialized) return alert('Firebase not ready');
postForm.reset();
postIdInput.value = '';
clearQuillEditor();
postModalLabel.textContent = 'Create New Post';
submitPostBtn.innerHTML = 'Publish Post';
new bootstrap.Modal(document.getElementById('postModal')).show();
});

adminLoginForm.addEventListener('submit', async (e) => {
e.preventDefault();
const email = document.getElementById('adminEmail').value.trim();
const pass = document.getElementById('adminPassword').value.trim();
if (!email || !pass) return showFormAlert('Enter email & password', 'error', loginAlertContainer);
const original = submitAdminLoginBtn.innerHTML;
submitAdminLoginBtn.disabled = true;
submitAdminLoginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
try {
await signInAdmin(email, pass);
showFormAlert('Signed in', 'success', loginAlertContainer);
adminLoginForm.reset();
} catch (err) { showFormAlert('Error: ' + err.message, 'error', loginAlertContainer); }
finally { submitAdminLoginBtn.disabled = false; submitAdminLoginBtn.innerHTML = original; }
});

// === SEARCH ===
if (searchInput) {
searchInput.addEventListener('input', (e) => {
const term = e.target.value.toLowerCase();
const cards = document.querySelectorAll('.blog-card');
let found = false;
cards.forEach(c => {
const title = c.querySelector('.blog-title')?.textContent.toLowerCase() || '';
const content = c.querySelector('.blog-content')?.textContent.toLowerCase() || '';
const tags = [...c.querySelectorAll('.blog-tags .badge')].map(b=>b.textContent.toLowerCase()).join(' ');
const show = title.includes(term) || content.includes(term) || tags.includes(term);
c.style.display = show ? 'block' : 'none';
if (show) found = true;
});
const existing = document.getElementById('searchNoResults');
if (existing) existing.remove();
if (!found && cards.length) {
const msg = document.createElement('div');
msg.id = 'searchNoResults';
msg.className = 'no-posts';
msg.innerHTML = '<i class="fas fa-search"></i><h3>No results</h3><p>Try different keywords</p>';
blogListView.appendChild(msg);
}
});
}

// === INIT ===
document.addEventListener('DOMContentLoaded', () => {
initializeFirebase();
initializeQuillEditor();
});

document.querySelectorAll('a[href^="#"]').forEach(a => {
a.addEventListener('click', function(e) {
if (this.href === location.href.split('#')[0] + '#') { e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); }
});
});
</script>
</body>
</html>
